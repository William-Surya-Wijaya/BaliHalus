<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw==" crossorigin="anonymous" referrerpolicy="no-referrer" />
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://code.jquery.com/ui/1.13.0/jquery-ui.min.js"></script>
<link rel="stylesheet" href="https://code.jquery.com/ui/1.13.0/themes/smoothness/jquery-ui.css" />

<link rel="stylesheet" href="//cdn.datatables.net/1.13.4/css/jquery.dataTables.min.css" />
<script src="//cdn.datatables.net/1.13.4/js/jquery.dataTables.min.js"></script>

<link rel="stylesheet" href="/baliHalus/historycss" />

<html>
  <body>
    <div id="page" class="main-page">

      <div class="main-page-header">
        <%- include('./layout/nav-bar.ejs') %>

        <div class="nav-content">
          <div class="row">
            <div class="col">
              <div class="nav-title">Reservations History.</div>
              <div class="nav-context">All of yours reservation history will be displayed here.</div>
              <div class="history-container" style="min-height: 27em !important; min-width: 100% !important;">
                <table class="history-table" id="historyTable" >
                  <thead>
                    <tr>
                      <th>No</th>
                      <th>Book ID</th>
                      <th>Service</th>
                      <th>Branch</th>
                      <th>Location</th>
                      <th>Reservation Time</th>
                      <th>Print</th>
                    </tr>
                  </thead>
                  <tbody>
                    <% const options = {
                      day: '2-digit',
                      month: 'short',
                      year: 'numeric',
                      hour: '2-digit',
                      minute: '2-digit',
                      hour12: true,
                    }; 
                      let i = 1;
                    %>
                    <% for(const row of data){ %>
                      <% 
                        const reservationTime = new Date(row.reservation_time);
                        const day = reservationTime.getDate().toString().padStart(2, '0');
                        const month = reservationTime.toLocaleString('default', { month: 'short' });
                        const nummonth = (reservationTime.getMonth() + 1).toString().padStart(2, '0');
                        const year = reservationTime.getFullYear();
                        const hour = reservationTime.getHours().toString().padStart(2, '0');
                        const minute = reservationTime.getMinutes().toString().padStart(2, '0');
                        const period = reservationTime.toLocaleString('en-US', { hour12: true, hour: 'numeric' }).split(' ')[1].toUpperCase();
                        const numDate = `${year}${month}${day}`
                        const formattedDate = `${day} ${month} ${year} ${hour}:${minute} ${period}`;
                      %>
                      <tr>
                        <td><%= i++ %></td>
                        <td><%= row.trans_num %></td>
                        <td><%= row.service %></td>
                        <td><%= row.branch %></td>
                        <td><%= row.location %></td>
                        <td><%= formattedDate %></td>
                        <td><center><button class="printButton"><i class="fa fa-print bold" aria-hidden="true"></i>Print</button></center></td>
                      </tr>
                    <% } %>
                    <% if (i<10) { %>
                      <% for(let n = i; n<6; n++){ %>
                        <tr>
                          <td><%= i++ %></td>
                          <td></td>
                          <td></td>
                          <td></td>
                          <td></td>
                          <td></td>
                          <td></td>
                        </tr>
                      <% } %>
                    <% } %>
                  </tbody>
                  <tfoot>
                    <tr>
                      <th colspan="100%"></th>
                    </tr>
                  </tfoot>
                </table>
              </div>
            </div>
          </div>
        </div>
      </div>

    </div>
  </body>
</html>

<script>
  const printsButton = document.querySelectorAll('.printButton');
  printsButton.forEach((button)=>{
    button.addEventListener("click", (event)=>{
      const idTrans = event.target.parentNode.parentNode.children[1];
      const reserv = event.target.parentNode.parentNode.children[2];
      const ruang = event.target.parentNode.parentNode.children[3];
      const branch = event.target.parentNode.parentNode.children[4];
      const location = event.target.parentNode.parentNode.children[5];
      const time = event.target.parentNode.parentNode.children[6];

      resLocation.innerHTML = location.innerHTML;
      resID.value = idTrans.innerHTML;
      reservA.value = reserv.innerHTML;

      Swal.fire({
        title: 'Print reservation pass ?',
        text: "Are you sure want to print this reservation pass ?",
        icon: 'question',
        background: "#f9faf4",
        color: '#1b2e1a',
        showCancelButton: true,
        confirmButtonColor: '#3085d6',
        cancelButtonColor: '#d33',
        confirmButtonText: 'Yes !'
      })
    });
  });
</script>